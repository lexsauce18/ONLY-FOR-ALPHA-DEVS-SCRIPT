--[[ 
    ALPHA HUB | Escape Tsunami For Brainrots
    REVISED VERSION (Rayfield)
]]

-- 1. WAIT FOR GAME TO LOAD
if not game:IsLoaded() then
    game.Loaded:Wait()
end

local Player = game.Players.LocalPlayer
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local TweenService = game:GetService("TweenService")

-- 2. NOTIFY USER
game:GetService("StarterGui"):SetCore("SendNotification", {
    Title = "Alpha Hub";
    Text = "Loading Interface...";
    Duration = 5,
})

-- 3. LOAD LIBRARY (Rayfield)
local Rayfield = loadstring(game:HttpGet('https://sirius.menu/rayfield'))()

-- 4. CREATE WINDOW
local Window = Rayfield:CreateWindow({
    Name = "ALPHA HUB | Escape Tsunami For Brainrots",
    LoadingTitle = "Alpha Hub Scripts",
    LoadingSubtitle = "by Alpha Hub Team",
    ConfigurationSaving = {
        Enabled = true,
        FolderName = "AlphaHubConfig",
        FileName = "AlphaHub"
    },
    Discord = {
        Enabled = false,
        Invite = "https://discord.gg/Suk9CryHvx",
        RememberJoins = true 
    },
    KeySystem = false, 
})

-- [[ Instant Execution Logic ]]
if workspace:FindFirstChild("Barriers") then
    workspace.Barriers:Destroy()
end

-- Notification to confirm the instant destruction worked
Rayfield:Notify({
   Title = "Barriers Destroyed",
   Content = "workspace.Barriers has been removed successfully.",
   Duration = 5,
   Image = 4483362458,
})

-- ==========================================
-- TAB 1: MAIN (User Stats)
-- ==========================================
local MainTab = Window:CreateTab("Main", 4483345998)
local InfoSection = MainTab:CreateSection("User Information")

MainTab:CreateLabel("Username: " .. Player.Name)
MainTab:CreateLabel("Display Name: " .. Player.DisplayName)
MainTab:CreateLabel("User ID: " .. Player.UserId)
MainTab:CreateLabel("Account Age: " .. Player.AccountAge .. " days")

local CreditsSection = MainTab:CreateSection("Credits")
MainTab:CreateLabel("Scripting: LexSauce / Alpha Hub Team")

local SocialSection = MainTab:CreateSection("Community")
MainTab:CreateButton({
    Name = "Copy Discord Invite",
    Callback = function()
        setclipboard("https://discord.gg/avGM6WQKCx")
        Rayfield:Notify({
            Title = "Link Copied!",
            Content = "The Discord invite has been copied to your clipboard.",
            Duration = 5,
            Image = 4483345998,
        })
    end,
})

-- ==========================================
-- TAB 2: GAME TAB
-- ==========================================
local GameTab = Window:CreateTab("Game Tab", 4483345998)

-- --- VIP NAVIGATION SECTION ---
GameTab:CreateSection("VIP Navigation ( DO NOT SPAM )")

-- THE UPDATED WALL DESTROYER
GameTab:CreateButton({
    Name = "Destroy VIP Walls",
    Callback = function()
        -- List of all possible folder locations (including ArcadeMap)
        local mapPaths = {
            workspace:FindFirstChild("ArcadeMap_SharedInstances"),
            workspace:FindFirstChild("MarsMap_SharedInstances"),
            workspace:FindFirstChild("MoneyMap_SharedInstances"),
            workspace:FindFirstChild("DefaultMap_SharedInstances")
        }

        local found = false

        -- Check defined paths first
        for _, folder in ipairs(mapPaths) do
            if folder and folder:FindFirstChild("VIPWalls") then
                folder.VIPWalls:Destroy()
                found = true
            end
        end

        -- Final deep-search backup if the folders above weren't present
        if not found then
            local backup = workspace:FindFirstChild("VIPWalls", true)
            if backup then
                backup:Destroy()
                found = true
            end
        end

        -- User Feedback
        if found then
            Rayfield:Notify({Title = "Alpha Hub", Content = "VIP Walls Destroyed!", Duration = 3})
        else
            Rayfield:Notify({Title = "Error", Content = "VIP Walls not found in any map!", Duration = 3})
        end
    end,
})

GameTab:CreateButton({
    Name = "VIP Up (+1)",
    Callback = function()
        local currentIndex = getNearestVIPIndex()
        if currentIndex < #vipLocations then
            tweenToVIP(vipLocations[currentIndex + 1])
        end
    end,
})

GameTab:CreateButton({
    Name = "VIP Down (-1)",
    Callback = function()
        local currentIndex = getNearestVIPIndex()
        if currentIndex > 1 then
            tweenToVIP(vipLocations[currentIndex - 1])
        end
    end,
})

-- DATA & LOGIC

-- VIP Locations from your script
local vipLocations = {
	Vector3.new(241.47, 3.27, -139.51),
	Vector3.new(341.39, 3.27, -139.50),
	Vector3.new(470.24, 3.27, -139.53),
	Vector3.new(647.98, 3.27, -139.51),
	Vector3.new(917.80, 3.27, -139.51),
	Vector3.new(1321.95, 3.27, -139.51),
	Vector3.new(1912.83, 3.27, -138.53),
	Vector3.new(2427.05, 3.27, -139.01)
}

local function getNearestGapIndex()
    local character = Player.Character
    if not character or not character:FindFirstChild("HumanoidRootPart") then return 1 end
    local root = character.HumanoidRootPart
    local closestIndex = 1
    local shortestDistance = math.huge
    for i, gap in ipairs(gaps) do
        if gap and gap:IsA("BasePart") then
            local dist = (root.Position - gap.Position).Magnitude
            if dist < shortestDistance then
                shortestDistance = dist
                closestIndex = i
            end
        end
    end
    return closestIndex
end

-- Nearest Index function for VIP
local function getNearestVIPIndex()
    local character = Player.Character
    if not character or not character:FindFirstChild("HumanoidRootPart") then return 1 end
    local root = character.HumanoidRootPart
    local closestIndex = 1
    local shortestDistance = math.huge
    for i, pos in ipairs(vipLocations) do
        local distance = (root.Position - pos).Magnitude
        if distance < shortestDistance then
            shortestDistance = distance
            closestIndex = i
        end
    end
    return closestIndex
end

local function tweenToGap(index)
    local character = Player.Character
    local targetPart = gaps[index]
    if not character or not character:FindFirstChild("HumanoidRootPart") or not targetPart then return end
    local root = character.HumanoidRootPart
    local tweenInfo = TweenInfo.new(1.2, Enum.EasingStyle.Quart, Enum.EasingDirection.Out)
    local targetCFrame = targetPart.CFrame * CFrame.new(0, 7, 0)
    local tween = TweenService:Create(root, tweenInfo, {CFrame = targetCFrame})
    tween:Play()
end

-- Tween function for VIP
local function tweenToVIP(targetVector)
    local character = Player.Character
    if not character or not character:FindFirstChild("HumanoidRootPart") then return end
    local root = character.HumanoidRootPart
    local tweenInfo = TweenInfo.new(1.5, Enum.EasingStyle.Quad, Enum.EasingDirection.Out)
    local targetCFrame = CFrame.new(targetVector + Vector3.new(0, 3, 0))
    
    root.Anchored = true
    local tween = TweenService:Create(root, tweenInfo, {CFrame = targetCFrame})
    tween:Play()
    tween.Completed:Connect(function()
        root.Anchored = false
    end)
end

GameTab:CreateLabel("DON'T GO NEAR THE WAVES PLAYER WILL DIE")

-- --- ESP SECTION ---
GameTab:CreateSection("ESP")

local LB_PATH = workspace:WaitForChild("ActiveLuckyBlocks")
_G.LB_ESP_Enabled = false
_G.LB_Filters = {"All"} 

local function RemoveESP(block)
    if block:FindFirstChild("ESPHighlight") then block.ESPHighlight:Destroy() end
    if block:FindFirstChild("ESPLabel") then block.ESPLabel:Destroy() end
end

local function ApplyLB_ESP(block)
    RemoveESP(block)
    if not _G.LB_ESP_Enabled then return end

    -- Validation: Only target models or parts
    if not (block:IsA("Model") or block:IsA("BasePart")) then return end

    task.wait(0.1) 
    if not block.Parent then return end 

    -- LOCK TO ROOTPART: This specifically targets the RootPart (like in your example) 
    -- to prevent the text from flying/circling around the map.
    local anchor = block:FindFirstChild("RootPart") or (block:IsA("Model") and block.PrimaryPart) or block:FindFirstChildWhichIsA("BasePart") or (block:IsA("BasePart") and block)
    
    if not anchor then return end

    local rarityObj = block:FindFirstChild("Rarity") or block:FindFirstChild("Type")
    local mutationObj = block:FindFirstChild("Mutation")
    
    local rarityName = rarityObj and tostring(rarityObj.Value) or block.Name
    local mutationName = mutationObj and tostring(mutationObj.Value) or ""
    local displayName = mutationName ~= "" and (mutationName .. " " .. rarityName) or rarityName
    
    local nameLower = string.lower(block.Name)
    local rarityLower = string.lower(rarityName)
    
    -- Detection Logic
    local isUfo = string.find(nameLower, "ufo") or string.find(rarityLower, "ufo")
    local isAdmin = string.find(nameLower, "admin") or string.find(rarityLower, "admin")
    local isRadioactive = string.find(nameLower, "radioactive") or string.find(rarityLower, "radioactive")
    local isMoney = string.find(nameLower, "money") or string.find(rarityLower, "money")
    local isCelestial = string.find(nameLower, "celestial") or string.find(rarityLower, "celestial")
    local isDivine = string.find(nameLower, "divine") or string.find(rarityLower, "divine")
    local isGamer = string.find(nameLower, "gamer") or string.find(rarityLower, "gamer")
    local isInfinity = string.find(nameLower, "infinity") or string.find(rarityLower, "infinity")
    
    if isUfo then displayName = "UFO" 
    elseif isAdmin then displayName = "ADMIN"
    elseif isRadioactive then displayName = "RADIOACTIVE"
    elseif isMoney then displayName = "MONEY"
    elseif isCelestial then displayName = "CELESTIAL"
    elseif isDivine then displayName = "DIVINE"
    elseif isGamer then displayName = "GAMER"
    elseif isInfinity then displayName = "INFINITY" end

    local shouldShow = false
    if table.find(_G.LB_Filters, "All") then
        shouldShow = true
    else
        for _, filterValue in ipairs(_G.LB_Filters) do
            if string.find(string.lower(displayName), string.lower(filterValue)) then
                shouldShow = true
                break
            end
        end
    end

    if not shouldShow then return end

    -- Highlight Logic
    local hl = Instance.new("Highlight")
    hl.Name = "ESPHighlight"
    hl.FillTransparency = 0.5
    hl.OutlineTransparency = 0
    
    if isAdmin then hl.FillColor = Color3.fromRGB(255, 50, 50) 
    elseif isRadioactive then hl.FillColor = Color3.fromRGB(150, 255, 0) 
    elseif isMoney then hl.FillColor = Color3.fromRGB(0, 255, 0)
    elseif isUfo then hl.FillColor = Color3.fromRGB(0, 255, 100) 
    elseif isCelestial then hl.FillColor = Color3.fromRGB(0, 180, 255)
    elseif isDivine then hl.FillColor = Color3.fromRGB(255, 255, 255)
    elseif isGamer then hl.FillColor = Color3.fromRGB(255, 0, 255)
    elseif isInfinity then hl.FillColor = Color3.fromRGB(75, 0, 130)
    else hl.FillColor = Color3.fromRGB(255, 215, 0) end
    hl.Parent = block

    -- Billboard Logic (FIXED SIZE & ANCHOR)
    local bb = Instance.new("BillboardGui")
    bb.Name = "ESPLabel"
    bb.Size = UDim2.new(0, 150, 0, 30)
    bb.StudsOffset = Vector3.new(0, 3, 0)
    bb.AlwaysOnTop = true
    bb.Adornee = anchor -- This forces the text to stay on the RootPart
    
    local lbl = Instance.new("TextLabel")
    lbl.Parent = bb
    lbl.BackgroundTransparency = 1
    lbl.Size = UDim2.new(1,0,1,0)
    lbl.Text = displayName
    lbl.TextColor3 = hl.FillColor
    lbl.TextStrokeTransparency = 0
    lbl.TextSize = 14 -- Default size
    lbl.Font = Enum.Font.GothamBold
    
    bb.Parent = block
end

-- --- AUTOMATION LOGIC ---
LB_PATH.ChildAdded:Connect(function(child)
    if _G.LB_ESP_Enabled then
        ApplyLB_ESP(child)
    end
end)

GameTab:CreateToggle({
    Name = "Enable Lucky Block ESP",
    CurrentValue = false,
    Flag = "LBToggle",
    Callback = function(Value)
        _G.LB_ESP_Enabled = Value
        for _, v in ipairs(LB_PATH:GetChildren()) do 
            if Value then ApplyLB_ESP(v) else RemoveESP(v) end 
        end
    end,
})

GameTab:CreateDropdown({
    Name = "Select Rarity Filter",
    Options = {"All", "Common", "Rare", "Epic", "Legendary", "Mythical", "Cosmic", "Secret", "Celestial", "Divine", "Ufo", "Admin", "Radioactive", "Money", "Gamer", "Infinity"},
    CurrentOption = {"All"},
    MultipleOptions = true, 
    Flag = "LBFilter",
    Callback = function(Options)
        _G.LB_Filters = Options 
        for _, v in ipairs(LB_PATH:GetChildren()) do ApplyLB_ESP(v) end
    end,
})

-- --- PROXIMITY SECTION ---
GameTab:CreateSection("Interaction")

_G.InstantPrompt = false
local originalDurations = {} 

GameTab:CreateToggle({
    Name = "Instant Proximity Prompt",
    CurrentValue = false,
    Flag = "InstantPromptToggle",
    Callback = function(Value)
        _G.InstantPrompt = Value
        if Value then
            for _, obj in ipairs(workspace:GetDescendants()) do
                if obj:IsA("ProximityPrompt") then
                    if not originalDurations[obj] then
                        originalDurations[obj] = obj.HoldDuration
                    end
                    obj.HoldDuration = 0
                end
            end
        else
            for obj, duration in pairs(originalDurations) do
                if obj and obj.Parent then
                    obj.HoldDuration = duration
                end
            end
            table.clear(originalDurations)
        end
    end,
})

workspace.DescendantAdded:Connect(function(obj)
    if obj:IsA("ProximityPrompt") then
        if _G.InstantPrompt then
            task.wait() -- Ensure the prompt is fully initialized
            originalDurations[obj] = obj.HoldDuration
            obj.HoldDuration = 0
        end
    end
end)

-- --- ZOOM UNLOCK BUTTON ---
GameTab:CreateButton({
    Name = "Unlock Max Zoom",
    Callback = function()
        _G.ZoomUnlocked = true
        Rayfield:Notify({
            Title = "Zoom Unlocked",
            Content = "Max Zoom set to 1000. You can now scroll out freely!",
            Duration = 5,
            Image = 4483345998,
        })
    end,
})

task.spawn(function()
    while true do
        if _G.ZoomUnlocked then
            Player.CameraMaxZoomDistance = 1000
        end
        task.wait(0.5)
    end
end)

GameTab:CreateSection("Player Settings")

GameTab:CreateToggle({
    Name = "Infinite Jump",
    CurrentValue = false,
    Flag = "ToggleInfJump", 
    Callback = function(Value)
        _G.InfJump = Value
    end,
})

local flying = false
local speed = 50 -- Default speed
local bv, bg
local Player = game.Players.LocalPlayer
local UserInputService = game:GetService("UserInputService")

-- Flight Toggle logic
local FlyToggle = GameTab:CreateToggle({
    Name = "Fly (On/Off)",
    CurrentValue = false,
    Flag = "FlyToggle",
    Callback = function(Value)
        flying = Value
        local char = Player.Character
        if flying then
            local root = char:FindFirstChild("HumanoidRootPart")
            if not root then return end
            
            bv = Instance.new("BodyVelocity")
            bv.Parent = root
            bv.MaxForce = Vector3.new(math.huge, math.huge, math.huge)
            
            bg = Instance.new("BodyGyro")
            bg.Parent = root
            bg.MaxTorque = Vector3.new(math.huge, math.huge, math.huge)
            bg.P = 9000
            
            task.spawn(function()
                while flying do
                    if bg and bv then
                        bg.CFrame = workspace.CurrentCamera.CFrame
                        local direction = Vector3.new(0,0,0)
                        
                        if UserInputService:IsKeyDown(Enum.KeyCode.W) then direction = direction + workspace.CurrentCamera.CFrame.LookVector end
                        if UserInputService:IsKeyDown(Enum.KeyCode.S) then direction = direction - workspace.CurrentCamera.CFrame.LookVector end
                        if UserInputService:IsKeyDown(Enum.KeyCode.A) then direction = direction - workspace.CurrentCamera.CFrame.RightVector end
                        if UserInputService:IsKeyDown(Enum.KeyCode.D) then direction = direction + workspace.CurrentCamera.CFrame.RightVector end
                        
                        -- Uses the updated 'speed' variable from the Input box
                        bv.Velocity = direction * speed
                    end
                    task.wait()
                end
                if bv then bv:Destroy() end
                if bg then bg:Destroy() end
            end)
        else
            if bv then bv:Destroy() end
            if bg then bg:Destroy() end
        end
    end,
})

-- Typeable Speed Input
GameTab:CreateInput({
   Name = "Fly Speed",
   PlaceholderText = "Enter speed (e.g. 100)",
   RemoveTextAfterFocusLost = false,
   Callback = function(Text)
       local num = tonumber(Text)
       if num then
           speed = num
       else
           -- Optional: Reset to default or notify if not a number
           speed = 50 
       end
   end,
})

-- Keybind to Toggle
GameTab:CreateKeybind({
   Name = "Fly Keybind",
   CurrentKeybind = "F",
   HoldToInteract = false,
   Flag = "FlyKeybind",
   Callback = function()
       FlyToggle:Set(not flying)
   end,
})

-- [[ ADVANCED ANTI-AFK BYPASS ]]
local Players = game:GetService("Players")
local VirtualUser = game:GetService("VirtualUser")
local LocalPlayer = Players.LocalPlayer

-- Check if you already have a Window variable, if not, ensure this is placed after your Window creation
-- _G.AntiAFKState is used to keep the toggle persistent
_G.AntiAFKState = _G.AntiAFKState or false


GameTab:CreateToggle({
   Name = "Anti-Afk",
   CurrentValue = _G.AntiAFKState,
   Flag = "AntiAFK_Toggle_v2", 
   Callback = function(Value)
      _G.AntiAFKState = Value
      if Value then
          Rayfield:Notify({
             Title = "Anti-AFK Active",
             Content = "Bypass active. Simulating input every 15s.",
             Duration = 3,
             Image = 4483362458,
          })
      end
   end,
})

-- The actual bypass logic
-- We use a task.spawn loop instead of the 'Idled' event, as some games block that event
task.spawn(function()
    while true do
        if _G.AntiAFKState then
            -- This simulates a mouse button click and a movement to trick the server
            pcall(function()
                VirtualUser:CaptureController()
                VirtualUser:ClickButton2(Vector2.new())
            end)
        end
        task.wait(15) -- Checks every 15 seconds
    end
end)

-- Extra Layer: Prevent the "Single Player" teleport
-- If the game tries to teleport you to a lobby place, this attempts to cancel it.
local TeleportService = game:GetService("TeleportService")
TeleportService.TeleportInitFailed:Connect(function(player, result, errorMessage)
    if _G.AntiAFKState and player == LocalPlayer then
        print("Blocked an AFK Teleport attempt.")
        return -- Stay in the current game
    end
end)

-- ==========================================
-- TAB 3: AUTOMATION
-- ==========================================
local Automation = Window:CreateTab("Automation", 4483345998)

Automation:CreateSection("Auto Collect Lucky Blocks")
-- Variables
local _G = {
    AutoCollect = false,
    SelectedRarities = {}, 
    TravelSpeed = 300,
    SafeZone = Vector3.new(103.63, 3.22, 0.27),
    UnderMapY = -20
}

local Player = game.Players.LocalPlayer
local Character = Player.Character or Player.CharacterAdded:Wait()
local RootPart = Character:WaitForChild("HumanoidRootPart")

-- Update Character Reference on Respawn
Player.CharacterAdded:Connect(function(NewCharacter)
    Character = NewCharacter
    RootPart = NewCharacter:WaitForChild("HumanoidRootPart")
end)

-- Status Label
local StatusLabel = Automation:CreateLabel("Status: Idle")

local function UpdateStatus(text)
    StatusLabel:Set("Status: " .. text)
end

-- Snap Method: Direct CFrame assignment for Y, Tween for X/Z
local function TravelTo(targetVector3)
    if not RootPart or not Character:FindFirstChild("Humanoid") then return end
    local TweenService = game:GetService("TweenService")
    
    -- 1. Snap Down (Instant Y change)
    RootPart.CFrame = CFrame.new(RootPart.Position.X, _G.UnderMapY, RootPart.Position.Z)
    
    -- 2. Tween to Target X/Z (Under Map)
    local travelTarget = Vector3.new(targetVector3.X, _G.UnderMapY, targetVector3.Z)
    local distance = (RootPart.Position - travelTarget).Magnitude
    local duration = distance / _G.TravelSpeed
    
    local tweenInfo = TweenInfo.new(duration, Enum.EasingStyle.Linear)
    local tween = TweenService:Create(RootPart, tweenInfo, {CFrame = CFrame.new(travelTarget)})
    tween:Play()
    tween.Completed:Wait()

    -- 3. Snap Up to Target (Instant surface appearance)
    RootPart.CFrame = CFrame.new(targetVector3)
end

-- Wave/Tsunami Detection
local function IsAreaSafe(position)
    for _, obj in pairs(workspace:GetChildren()) do
        if (obj.Name:find("Wave") or obj.Name:find("Tsunami") or obj.Name:find("Flood")) and obj:IsA("BasePart") then
            if (obj.Position - position).Magnitude < 60 then 
                return false
            end
        end
    end
    return true
end

-- Main Collection Loop
task.spawn(function()
    while true do
        task.wait(0.5)
        
        if _G.AutoCollect then
            if not Character or not RootPart or not RootPart.Parent then
                UpdateStatus("Waiting for Respawn...")
                repeat task.wait(1) until RootPart and RootPart.Parent
            end

            local folder = workspace:FindFirstChild("ActiveLuckyBlocks")
            local targetBlock = nil
            
            UpdateStatus("Scanning for Rarities...")
            
            if folder then
                for _, block in pairs(folder:GetChildren()) do
                    local nameParts = block.Name:split("_")
                    local rarity = nameParts[2]
                    
                    if rarity and _G.SelectedRarities[rarity] then
                        targetBlock = block
                        break 
                    end
                end
                
                if targetBlock and targetBlock:FindFirstChild("RootPart") then
                    local prompt = targetBlock.RootPart:FindFirstChild("ProximityPrompt")
                    
                    if prompt then
                        prompt.HoldDuration = 0
                        
                        UpdateStatus("Traveling to " .. targetBlock.Name .. "...")
                        TravelTo(targetBlock.RootPart.Position)
                        
                        -- Disaster Safety Check
                        if not IsAreaSafe(targetBlock.RootPart.Position) then
                            UpdateStatus("Waiting for Disaster to Clear...")
                            while not IsAreaSafe(targetBlock.RootPart.Position) and _G.AutoCollect do
                                task.wait(0.5)
                            end
                        end
                        
                        UpdateStatus("Collecting...")
                        task.wait(0.1)
                        fireproximityprompt(prompt)
                        
                        -- Verification Step
                        local timeout = 0
                        while targetBlock.Parent == folder and timeout < 30 do 
                            UpdateStatus("Verifying Collection...")
                            task.wait(0.1)
                            timeout = timeout + 1
                            if timeout % 10 == 0 then fireproximityprompt(prompt) end 
                        end
                        
                        UpdateStatus("Block Vanished! Snapping to Safe Zone...")
                        TravelTo(_G.SafeZone)
                        UpdateStatus("Idle at Safe Zone")
                    end
                else
                    UpdateStatus("No Selected Rarities Found")
                end
            end
        else
            UpdateStatus("Auto-Collect Disabled")
        end
    end
end)

--- UI CONTROLS ---
Automation:CreateToggle({
   Name = "Auto Collect Toggle",
   CurrentValue = false,
   Callback = function(Value)
      _G.AutoCollect = Value
   end,
})

Automation:CreateDropdown({
   Name = "Target Rarities",
   Options = {"Common", "Uncommon", "Rare", "Epic", "Legendary", "Mythical", "Cosmic", "Secret", "Celestial", "Divine", "Infinity", "Gamer", "Ufo", "Admin", "Radioactive", "Candy", "Money"},
   CurrentOption = {},
   MultipleOptions = true,
   Callback = function(Options)
      _G.SelectedRarities = {}
      for _, v in pairs(Options) do
          _G.SelectedRarities[v] = true
      end
   end,
})

Automation:CreateSlider({
   Name = "Travel Speed",
   Range = {50, 1000},
   Increment = 10,
   Suffix = "SPS",
   CurrentValue = 300,
   Callback = function(Value)
      _G.TravelSpeed = Value
   end,
})

--- AUTO TRIALS ---

-- Variables
local Player = game:GetService("Players").LocalPlayer
local Character = Player.Character or Player.CharacterAdded:Wait()
local TweenService = game:GetService("TweenService")
local _Toggled = false
local UnderMapY = -18 
local TravelSpeed = 1000 
local SafetyDistance = 50 

local TowerPos = Vector3.new(4320.56, 6.92, -3.54)
local RarityList = {"Common", "Uncommon", "Rare", "Epic", "Legendary", "Mythical", "Cosmic", "Secret", "Celestial", "Divine", "Infinity"}

-- Remotes
local Networking = game:GetService("ReplicatedStorage").Shared.Remotes.Networking
local ConfirmRemote = Networking["RE/Tower/TowerConfirmClaim"]
local ClaimedRemote = Networking["RE/Tower/TowerClaimConfirmed"]

-- Paths
local TowerPrompt = workspace.GameObjects.PlaceSpecific.root.Tower.Main.Prompt.ProximityPrompt
local BillboardPath = workspace.GameObjects.PlaceSpecific.root.Tower.Main.Billboard.BillboardGui.Frame.Info.Requirement

-- Character Handling
Player.CharacterAdded:Connect(function(newChar)
    Character = newChar
end)

-- Helper: Tsunami Safety Check
local function isTsunamiNear(targetPos)
    for _, tsunami in pairs(workspace.ActiveTsunamis:GetChildren()) do
        local tsunamiPart = tsunami:FindFirstChildWhichIsA("BasePart") or tsunami
        if tsunamiPart and (tsunamiPart.Position - targetPos).Magnitude < SafetyDistance then
            return true
        end
    end
    return false
end

-- Helper: Movement Logic
local function snapAndTween(targetPos, isCollecting, targetObject)
    local root = Character:FindFirstChild("HumanoidRootPart")
    local humanoid = Character:FindFirstChild("Humanoid")
    if not root or not humanoid or humanoid.Health <= 0 then return false end

    root.Velocity = Vector3.zero
    root.CFrame = CFrame.new(root.Position.X, UnderMapY, root.Position.Z)
    task.wait(0.01)

    local targetUnder = Vector3.new(targetPos.X, UnderMapY, targetPos.Z)
    local dist = (root.Position - targetUnder).Magnitude
    local travelTween = TweenService:Create(root, TweenInfo.new(dist / TravelSpeed, Enum.EasingStyle.Linear), {CFrame = CFrame.new(targetUnder)})
    
    travelTween:Play()
    
    if isCollecting and targetObject then
        while travelTween.PlaybackState == Enum.PlaybackState.Playing do
            if not targetObject or not targetObject.Parent or not targetObject:FindFirstChild("Root") or humanoid.Health <= 0 then
                travelTween:Cancel()
                return false 
            end
            task.wait(0.05)
        end
    else
        travelTween.Completed:Wait()
    end
    
    root.Velocity = Vector3.zero

    -- Tsunami Safety: Stay at Travel Y level (-18) if dangerous
    if isCollecting then
        if isTsunamiNear(targetPos) then
            StatusLabel:Set("Status: Tsunami Danger! Hovering at Safety Depth...")
            while _Toggled and isTsunamiNear(targetPos) and humanoid.Health > 0 do
                root.CFrame = CFrame.new(targetPos.X, UnderMapY, targetPos.Z)
                task.wait(0.1)
            end
        end
    end

    if humanoid.Health > 0 then
        root.CFrame = CFrame.new(targetPos)
        task.wait(0.15)
        return true
    end
    return false
end

Automation:CreateSection("Auto Trials")
local StatusLabel = Automation:CreateLabel("Status: Idle")

Automation:CreateToggle({
    Name = "Start Auto Trial",
    CurrentValue = false,
    Callback = function(Value)
        _Toggled = Value
        if _Toggled then
            task.spawn(function()
                while _Toggled do
                    local HUD = Player.PlayerGui:FindFirstChild("TowerTrialHUD")
                    local humanoid = Character:FindFirstChild("Humanoid")
                    
                    -- Death Handler
                    if not humanoid or humanoid.Health <= 0 then
                        StatusLabel:Set("Status: Waiting for Respawn...")
                        repeat task.wait(0.5) until Character:FindFirstChild("Humanoid") and Character.Humanoid.Health > 0
                        task.wait(1.5)
                    end

                    -- Phase 1: START TRIAL
                    if not HUD or not HUD.TrialBar.Visible then
                        StatusLabel:Set("Status: Snapping to Tower")
                        snapAndTween(TowerPos, false)
                        fireproximityprompt(TowerPrompt)
                        task.wait(1)
                    end

                    if HUD and HUD.TrialBar.Visible then
                        local textFound = BillboardPath.Text
                        local detectedRarity = nil
                        for _, rarity in pairs(RarityList) do
                            if string.find(textFound, rarity) then
                                detectedRarity = rarity
                                break
                            end
                        end
                        
                        local depositStatus = HUD.TrialBar.Deposits.Text   
                        local current, total = depositStatus:match("(%d+)/(%d+)")
                        
                        -- Phase 3: COMPLETE RUN (REMOTES)
                        if current == total then
                            StatusLabel:Set("Status: 10/10! Claiming via Remotes...")
                            snapAndTween(TowerPos, false)
                            
                            ConfirmRemote:FireServer()
                            task.wait(0.2)
                            ClaimedRemote:FireServer()
                            
                            -- Sync wait after completion
                            task.wait(3.5) 
                        elseif detectedRarity then
                            -- Phase 4: COLLECT
                            local folder = workspace.ActiveBrainrots:FindFirstChild(detectedRarity)
                            local targetItem = folder and folder:GetChildren()[1]
                            
                            if targetItem and targetItem:FindFirstChild("Root") then
                                local targetPos = targetItem:GetPivot().Position
                                StatusLabel:Set("Status: Moving to " .. detectedRarity)
                                
                                local success = snapAndTween(targetPos, true, targetItem)
                                
                                if success then
                                    local takePrompt = targetItem.Root:FindFirstChild("TakePrompt")
                                    if takePrompt then
                                        local retryTimer = 0
                                        while targetItem and targetItem.Parent == folder and retryTimer < 15 and humanoid.Health > 0 do
                                            takePrompt.HoldDuration = 0
                                            fireproximityprompt(takePrompt)
                                            task.wait(0.1)
                                            retryTimer = retryTimer + 1
                                        end

                                        -- Phase 5: DEPOSIT
                                        if not targetItem or targetItem.Parent ~= folder then
                                            StatusLabel:Set("Status: Depositing...")
                                            task.wait(0.1)
                                            snapAndTween(TowerPos, false)
                                            fireproximityprompt(TowerPrompt)
                                            
                                            -- UPDATED: 3.5 Second Sync Wait
                                            StatusLabel:Set("Status: Syncing New Rarity (3.5s)...")
                                            local root = Character:FindFirstChild("HumanoidRootPart")
                                            if root then root.Velocity = Vector3.zero end
                                            task.wait(3.5) 
                                        end
                                    end
                                end
                            else
                                StatusLabel:Set("Status: Searching for " .. detectedRarity)
                                task.wait(0.3)
                            end
                        end
                    end
                    task.wait(0.05)
                end
            end)
        end
    end,
})

--- AUTO COIN EVENT ---

Automation:CreateSection("Auto Collect Coins")

_G.AutoCollectArcade = false
_G.AutoCollectTickets = false -- New Toggle Variable

-- [ARCADE CONSOLES]
Automation:CreateToggle({
    Name = "Auto-Collect Arcade Consoles",
    CurrentValue = false,
    Flag = "ArcadeToggle",
    Callback = function(Value)
        _G.AutoCollectArcade = Value
        if _G.AutoCollectArcade then
            task.spawn(function()
                while _G.AutoCollectArcade do
                    pcall(function()
                        local arcadeFolder = workspace:FindFirstChild("ArcadeEventConsoles")
                        local hrp = Player.Character and Player.Character:FindFirstChild("HumanoidRootPart")
                        
                        if arcadeFolder and hrp then
                            for _, console in ipairs(arcadeFolder:GetChildren()) do
                                if not _G.AutoCollectArcade then break end
                                local targetPart = console:FindFirstChild("Game Console") or (console:IsA("BasePart") and console)
                                
                                if targetPart and hrp then
                                    -- FLING FIX --
                                    targetPart.CanCollide = false
                                    targetPart.Velocity = Vector3.new(0,0,0)
                                    
                                    targetPart.CFrame = hrp.CFrame
                                    task.delay(0.9, function()
                                        if console then console:Destroy() end
                                    end)
                                end
                            end
                        end
                    end)
                    task.wait(1)
                end
            end)
        end
    end,
})

-- [ARCADE TICKETS] - NEW ADDITION
Automation:CreateToggle({
    Name = "Auto-Collect Arcade Tickets",
    CurrentValue = false,
    Flag = "TicketToggle",
    Callback = function(Value)
        _G.AutoCollectTickets = Value
        if _G.AutoCollectTickets then
            task.spawn(function()
                while _G.AutoCollectTickets do
                    pcall(function()
                        local ticketFolder = workspace:FindFirstChild("ArcadeEventTickets")
                        local hrp = Player.Character and Player.Character:FindFirstChild("HumanoidRootPart")
                        
                        if ticketFolder and hrp then
                            for _, ticketModel in ipairs(ticketFolder:GetChildren()) do
                                if not _G.AutoCollectTickets then break end
                                
                                -- Targets the "Ticket" part inside the model
                                local realTicket = ticketModel:FindFirstChild("Ticket")
                                if realTicket and realTicket:IsA("BasePart") then
                                    -- FLING FIX --
                                    realTicket.CanCollide = false
                                    realTicket.Velocity = Vector3.new(0,0,0)
                                    
                                    -- Bring the ticket to you and trigger the touch
                                    realTicket.CFrame = hrp.CFrame
                                    firetouchinterest(hrp, realTicket, 0)
                                    task.wait(0.05) -- Brief wait to ensure registration
                                    firetouchinterest(hrp, realTicket, 1)
                                    
                                    -- REMOVED: ticketModel:Destroy() 
                                    -- Let the game server handle the removal upon successful collection
                                end
                            end
                        end
                    end)
                    task.wait(1)
                end
            end)
        end
    end,
})

-- [MONEY COINS]
_G.AutoTPMoneyEvent = false
_G.MoneyTPDelay = 0.2 

Automation:CreateToggle({
    Name = "Auto-Collect All Money Coins",
    CurrentValue = false,
    Flag = "MoneyEventTPToggle",
    Callback = function(Value)
        _G.AutoTPMoneyEvent = Value
        if Value then
            task.spawn(function()
                while _G.AutoTPMoneyEvent do
                    local hrp = Player.Character and Player.Character:FindFirstChild("HumanoidRootPart")
                    local moneyFolder = workspace:FindFirstChild("MoneyEventParts")
                    
                    if hrp and moneyFolder then
                        for _, coin in ipairs(moneyFolder:GetChildren()) do
                            if not _G.AutoTPMoneyEvent then break end
                            local mainPart = coin:FindFirstChild("Main")
                            
                            if mainPart and mainPart:IsA("BasePart") then
                                -- FLING FIX --
                                mainPart.CanCollide = false
                                mainPart.Velocity = Vector3.zero
                                mainPart.RotVelocity = Vector3.zero
                                
                                mainPart.CFrame = hrp.CFrame * CFrame.new(0, 0, -1)
                                firetouchinterest(hrp, mainPart, 0)
                                task.wait(0.05)
                                firetouchinterest(hrp, mainPart, 1)
                                
                                task.delay(0.9, function()
                                    if coin and coin.Parent then coin:Destroy() end
                                end)
                                task.wait(_G.MoneyTPDelay)
                            end
                        end
                    end
                    task.wait(1) 
                end
            end)
        end
    end,
})

-- [UFO COINS]
_G.AutoCollectUFO = false
_G.UFO_Delay = 0.15

Automation:CreateToggle({
    Name = "Auto-Collect UFO Coins",
    CurrentValue = false,
    Flag = "UFOToggle",
    Callback = function(Value)
        _G.AutoCollectUFO = Value
        if _G.AutoCollectUFO then
            task.spawn(function()
                local CoinBombEvent = ReplicatedStorage.Packages.Net:FindFirstChild("RE/CoinBombEvent")
                while _G.AutoCollectUFO do
                    local UFOParts = workspace:FindFirstChild("UFOEventParts")
                    if UFOParts then
                        for _, coin in ipairs(UFOParts:GetChildren()) do
                            if not _G.AutoCollectUFO then break end
                            local hitbox = coin:FindFirstChild("Hitbox")
                            local hrp = Player.Character and Player.Character:FindFirstChild("HumanoidRootPart")
                            
                            if hitbox and hrp then
                                -- FLING FIX --
                                hitbox.CanCollide = false
                                hitbox.Velocity = Vector3.zero
                                
                                hitbox.CFrame = hrp.CFrame
                                if CoinBombEvent then CoinBombEvent:FireServer(coin) end
                                task.delay(0.9, function()
                                    if coin then coin:Destroy() end
                                end)
                            end
                            task.wait(_G.UFO_Delay)
                        end
                    end
                    task.wait(1)
                end
            end)
        end
    end,
})

-- [RADIOACTIVE COINS]
_G.AutoCollectRadioactive = false
Automation:CreateToggle({
    Name = "Auto-Collect Radioactive Coins",
    CurrentValue = false,
    Flag = "RadioactiveToggle",
    Callback = function(Value)
        _G.AutoCollectRadioactive = Value
        if _G.AutoCollectRadioactive then
            task.spawn(function()
                while _G.AutoCollectRadioactive do
                    pcall(function()
                        local eventFolder = workspace:FindFirstChild("EventParts")
                        local hrp = Player.Character and Player.Character:FindFirstChild("HumanoidRootPart")
                        
                        if eventFolder and hrp then
                            for _, folder in ipairs(eventFolder:GetChildren()) do
                                for _, coin in ipairs(folder:GetChildren()) do
                                    if coin.Name == "Radioactive Coin" then
                                        -- FLING FIX --
                                        coin.CanCollide = false
                                        coin.Velocity = Vector3.zero
                                        
                                        coin.CFrame = hrp.CFrame
                                        task.delay(0.9, function() 
                                            if coin then coin:Destroy() end 
                                        end)
                                    end
                                end
                            end
                        end
                    end)
                    task.wait(0.5)
                end
            end)
        end
    end,
})

Automation:CreateSection("Selling System")

Automation:CreateButton({
    Name = "Sell Holding",
    Callback = function()
        local tool = Player.Character and Player.Character:FindFirstChildOfClass("Tool")
        if tool then
            SellToolRemote:InvokeServer(tool)
        else
            Rayfield:Notify({Title = "Error", Content = "Hold an item to sell it!", Duration = 3})
        end
    end,
})

Automation:CreateButton({
    Name = "Sell All Items",
    Callback = function()
        SellAllRemote:InvokeServer()
    end,
})

Automation:CreateSection("Upgrades & Rebirth")

_G.AutoBuySpeed = false
Automation:CreateToggle({
   Name = "Auto-Buy Speed Upgrades",
   CurrentValue = false,
   Flag = "AutoBuyToggle",
   Callback = function(Value)
       _G.AutoBuySpeed = Value
       if _G.AutoBuySpeed then
           task.spawn(function()
               while _G.AutoBuySpeed do
                   pcall(function()
                       UpgradeRemote:InvokeServer(10)
                   end)
                   task.wait(0.5)
               end
           end)
       end
   end,
})

_G.AutoRebirth = false
Automation:CreateToggle({
    Name = "Auto-Rebirth (Fast)",
    CurrentValue = false,
    Flag = "AutoRebirthToggle",
    Callback = function(Value)
        _G.AutoRebirth = Value
        if _G.AutoRebirth then
            task.spawn(function()
                while _G.AutoRebirth do
                    pcall(function() RebirthRemote:InvokeServer() end)
                    task.wait(1)
                end
            end)
        end
    end,
})

-- // PLOT DETECTION LOGIC //
local MyPlotID = "Searching..."
local SelectedStands = {"5"}

local function FindMyBase()
    local basesFolder = workspace:FindFirstChild("Bases")
    if not basesFolder then return nil end
    for _, base in pairs(basesFolder:GetChildren()) do
        local pNameLabel = base:FindFirstChild("PlayerName", true) -- Recursive search for the name label
        if pNameLabel and (pNameLabel.Text == Player.Name or pNameLabel.Text == Player.DisplayName or string.find(pNameLabel.Text, Player.Name)) then
            return base.Name 
        end
    end
    return nil
end

task.spawn(function()
    while MyPlotID == "Searching..." do
        local id = FindMyBase()
        if id then MyPlotID = id break end
        task.wait(2)
    end
end)

-- --- BRAINROT PLOT SECTION ---

Automation:CreateSection("Auto Upgrade & Collect Money")

-- Money collection kept exactly as requested
Automation:CreateToggle({
   Name = "Auto-Collect Money",
   CurrentValue = false,
   Flag = "AutoCollPlot",
   Callback = function(Value)
      _G.AutoCollectPlot = Value
      if Value then
         task.spawn(function()
            local remote = ReplicatedStorage:WaitForChild("Packages"):WaitForChild("Net"):FindFirstChild("RF/Plot.PlotAction")
            while _G.AutoCollectPlot do
               if MyPlotID ~= "Searching..." and remote then
                  for i = 1, 99 do
                     if not _G.AutoCollectPlot then break end
                     pcall(function() remote:InvokeServer("Collect Money", MyPlotID, tostring(i)) end)
                     task.wait(0.01)
                  end
               end
               task.wait(1)
            end
         end)
      end
   end,
})

Automation:CreateDropdown({
    Name = "Select Target Stands",
    -- Options now go up to 35
    Options = {"1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30","31","32","33","34","35"},
    CurrentOption = {"5"},
    MultipleOptions = true,
    Flag = "GlobalStandSelector",
    Callback = function(Options) SelectedStands = Options end,
})

-- Variable to control the loop
_G.AutoUpgradeBrainrot = false

-- The Toggle: For hands-free upgrading
Automation:CreateToggle({
    Name = "Auto-Upgrade Brainrot (Loop)",
    CurrentValue = false,
    Flag = "AutoUpgLoop",
    Callback = function(Value)
        _G.AutoUpgradeBrainrot = Value
        
        if Value then
            task.spawn(function()
                local remote = ReplicatedStorage:WaitForChild("Packages"):WaitForChild("Net"):FindFirstChild("RF/Plot.PlotAction")
                
                while _G.AutoUpgradeBrainrot do
                    if MyPlotID ~= "Searching..." and remote then
                        for _, standNum in ipairs(SelectedStands) do
                            -- Check current level before spamming
                            local currentLevel = 0
                            pcall(function()
                                local plot = workspace.Bases:FindFirstChild(MyPlotID)
                                local stand = plot.Stands:FindFirstChild(tostring(standNum))
                                local lvlObj = stand:FindFirstChild("Level") or stand:FindFirstChild("Stage") or (stand:FindFirstChild("Configuration") and stand.Configuration:FindFirstChild("Level"))
                                
                                if lvlObj then
                                    currentLevel = lvlObj.Value
                                elseif stand:GetAttribute("Level") then
                                    currentLevel = stand:GetAttribute("Level")
                                end
                            end)

                            -- Only upgrade if below 175
                            if currentLevel < 175 then
                                pcall(function() 
                                    remote:InvokeServer("Upgrade Brainrot", MyPlotID, tostring(standNum)) 
                                end)
                            end
                        end
                    end
                    -- Small wait between loop cycles to prevent lag
                    task.wait(0.1) 
                end
            end)
        end
    end,
})

Automation:CreateButton({
    Name = "Instant Max Brainrot (200)", -- Updated Name
    Callback = function()
       if MyPlotID == "Searching..." then Rayfield:Notify({Title = "Error", Content = "Base not found!", Duration = 3}) return end
       local remote = ReplicatedStorage:WaitForChild("Packages"):WaitForChild("Net"):FindFirstChild("RF/Plot.PlotAction")
       
       for _, standNum in ipairs(SelectedStands) do
          task.spawn(function()
             local currentLevel = 0
             pcall(function()
                 local plot = workspace.Bases:FindFirstChild(MyPlotID)
                 local stand = plot.Stands:FindFirstChild(tostring(standNum))
                 local lvlObj = stand:FindFirstChild("Level") or stand:FindFirstChild("Stage") or (stand:FindFirstChild("Configuration") and stand.Configuration:FindFirstChild("Level"))
                 
                 if lvlObj then 
                    currentLevel = lvlObj.Value
                 elseif stand:GetAttribute("Level") then 
                    currentLevel = stand:GetAttribute("Level") 
                 end
             end)

             local MAX_LEVEL = 200 -- Updated Max Level
             local needed = MAX_LEVEL - currentLevel
             
             if needed > 0 then
                 for i = 1, needed do
                    task.spawn(function() 
                        pcall(function() remote:InvokeServer("Upgrade Brainrot", MyPlotID, tostring(standNum)) end)
                    end)
                    -- Small delay every 15 iterations to prevent potential remote exhaustion/kick
                    if i % 15 == 0 then task.wait(0.02) end 
                 end
             end
          end)
       end
       Rayfield:Notify({Title = "Alpha Hub", Content = "Upgrading to Level 200...", Duration = 2})
    end,
})

-- ==========================================
-- TAB 3:  AFK FUSE MACHINE
-- ==========================================
local Afk = Window:CreateTab("Afk Fuse", 4483345998)
Afk:CreateSection("Afk Status")
-- Variables
local selectedTime = 30
local selectedMachine = "Default"
local autoDeposit = false
local autoCraft = false
local countdown = 0
local isProcessing = false
local copiedItemID = nil
local autoEquipEnabled = false

-- Machine Names for Auto-Detection
local machineNames = {"ATM", "Blackhole", "Arcade", "Valentines", "Doom"}

-- Updated Path Helper
local function getMachineFolder()
    return workspace:WaitForChild("GameObjects"):WaitForChild("PlaceSpecific"):WaitForChild("root"):WaitForChild("SpawnMachines")
end

-- Coordinates
local machineCoords = Vector3.new(897.34, -8.38, -23.02)
local blackholeCoords = Vector3.new(896.62, -8.38, 1.68)
local atmCoords = Vector3.new(897.96, -8.38, 27.33) 
local surfaceCoords = Vector3.new(125.89, 3.22, 0.72)
local defaultBlinkCoords = Vector3.new(135.40, 3.22, 138.60)

-- Helper: Create Static Platforms
local function setupStaticPlatforms()
    if workspace:FindFirstChild("ATM_Platform") then workspace.ATM_Platform:Destroy() end
    if workspace:FindFirstChild("Machine_Platform") then workspace.Machine_Platform:Destroy() end
    if workspace:FindFirstChild("Blackhole_Platform") then workspace.Blackhole_Platform:Destroy() end

    local platATM = Instance.new("Part")
    platATM.Name = "ATM_Platform"
    platATM.Parent = workspace
    platATM.Size = Vector3.new(15, 1, 15)
    platATM.Position = atmCoords - Vector3.new(0, 3.5, 0)
    platATM.Anchored = true
    platATM.Transparency = 0.5
    platATM.BrickColor = BrickColor.new("Cyan")
    platATM.CanCollide = true

    local platMachine = Instance.new("Part")
    platMachine.Name = "Machine_Platform"
    platMachine.Parent = workspace
    platMachine.Size = Vector3.new(15, 1, 15)
    platMachine.Position = machineCoords - Vector3.new(0, 3.5, 0)
    platMachine.Anchored = true
    platMachine.Transparency = 0.5
    platMachine.BrickColor = BrickColor.new("Neon orange")
    platMachine.CanCollide = true

    local platBH = Instance.new("Part")
    platBH.Name = "Blackhole_Platform"
    platBH.Parent = workspace
    platBH.Size = Vector3.new(15, 1, 15)
    platBH.Position = blackholeCoords - Vector3.new(0, 3.5, 0)
    platBH.Anchored = true
    platBH.Transparency = 0.5
    platBH.BrickColor = BrickColor.new("Really black")
    platBH.CanCollide = true
end

-- Helper: Find Any Machine 
local function getActiveMachine()
    local folder = getMachineFolder()
    
    if selectedMachine == "All Machine" then
        for _, name in ipairs(machineNames) do
            local found = folder:FindFirstChild(name)
            if found then return found end
        end
    else
        return folder:FindFirstChild(selectedMachine)
    end
    return nil
end

-- Helper: Tween Functions
local function tweenToMachine(targetPos)
    local hrp = game.Players.LocalPlayer.Character:WaitForChild("HumanoidRootPart")
    local ts = game:GetService("TweenService")
    local info = TweenInfo.new(2, Enum.EasingStyle.Linear)
    ts:Create(hrp, info, {CFrame = CFrame.new(hrp.Position.X, targetPos.Y, hrp.Position.Z)}):Play()
    task.wait(2.1)
    ts:Create(hrp, info, {CFrame = CFrame.new(targetPos)}):Play()
    task.wait(2.1)
end

local function tweenToSurface(targetPos)
    local hrp = game.Players.LocalPlayer.Character:WaitForChild("HumanoidRootPart")
    local ts = game:GetService("TweenService")
    local info = TweenInfo.new(2, Enum.EasingStyle.Linear)
    ts:Create(hrp, info, {CFrame = CFrame.new(targetPos.X, hrp.Position.Y, targetPos.Z)}):Play()
    task.wait(2.1)
    ts:Create(hrp, info, {CFrame = CFrame.new(targetPos)}):Play()
end

local TimeLabel = Afk:CreateLabel("Next Cycle: Ready")

Afk:CreateSection("Afk Settings")

-----------------------------------------------------------
-- AUTO BRAINROT EQUIP UI
-----------------------------------------------------------
local IDLabel = Afk:CreateLabel("Current ID: None")

Afk:CreateButton({
    Name = "Copy Held Item ID",
    Callback = function()
        local tool = game.Players.LocalPlayer.Character:FindFirstChildOfClass("Tool")
        if tool then 
            copiedItemID = tool.Name 
            IDLabel:Set("Current ID: "..tool.Name) 
            setclipboard(tool.Name) 
            Rayfield:Notify({Title = "ID Copied", Content = "Item: " .. tool.Name .. " copied to clipboard", Duration = 3})
        else
            Rayfield:Notify({Title = "Error", Content = "Please hold an item first!", Duration = 3})
        end
    end,
})

Afk:CreateToggle({
    Name = "Auto Equip Item", 
    CurrentValue = false, 
    Callback = function(v) 
        autoEquipEnabled = v 
    end
})

-----------------------------------------------------------
-- CORE AUTOMATION LOOP
-----------------------------------------------------------
spawn(function()
    while task.wait(1) do
        if autoDeposit or autoCraft then
            if countdown <= 0 and not isProcessing then
                local machineObj = getActiveMachine()
                
                if not machineObj then
                    TimeLabel:Set("Waiting for machine...")
                    continue 
                end

                isProcessing = true
                
                -- Updated Remote Path
                local remote = game:GetService("ReplicatedStorage"):WaitForChild("Shared"):WaitForChild("Remotes"):WaitForChild("Networking"):WaitForChild("RF/SpawnMachineAction")
                local hrp = game.Players.LocalPlayer.Character:FindFirstChild("HumanoidRootPart")

                if hrp then
                    local targetPos = machineCoords
                    if machineObj.Name == "ATM" then
                        targetPos = atmCoords
                    elseif machineObj.Name == "Blackhole" then
                        targetPos = blackholeCoords
                    end
                    
                    if machineObj.Name == "Default" then
                        hrp.CFrame = CFrame.new(defaultBlinkCoords)
                        task.wait(0.5)
                    else
                        local dist = (hrp.Position - targetPos).Magnitude
                        if dist > 10 then
                            TimeLabel:Set("Status: Traveling...")
                            tweenToMachine(targetPos)
                        end
                    end

                    if autoDeposit then
                        TimeLabel:Set("Status: Depositing...")
                        pcall(function() remote:InvokeServer("Deposit", machineObj) end)
                        task.wait(1.5)
                    end

                    if autoCraft then
                        TimeLabel:Set("Status: Crafting...")
                        pcall(function() remote:InvokeServer("Combine", machineObj) end)
                        task.wait(2)
                    end

                    countdown = selectedTime
                end
                
                isProcessing = false
            elseif countdown > 0 then
                countdown = countdown - 1
                TimeLabel:Set(countdown >= 60 and "Next Cycle: "..math.floor(countdown/60).."m "..(countdown%60).."s" or "Next Cycle: "..countdown.."s")
            else
                TimeLabel:Set("Next Cycle: Ready")
            end
        else
            TimeLabel:Set("Automation: Paused")
            countdown = 0
            isProcessing = false
        end
    end
end)

-- Auto Equip Loop
spawn(function()
    while task.wait(0.5) do
        if autoEquipEnabled and copiedItemID then
            local p = game.Players.LocalPlayer
            if p.Character and not p.Character:FindFirstChild(copiedItemID) then
                local t = p.Backpack:FindFirstChild(copiedItemID)
                if t then t.Parent = p.Character end
            end
        end
    end
end)

-----------------------------------------------------------
-- AUTOMATION SETTINGS UI
-----------------------------------------------------------
Afk:CreateDropdown({
    Name = "Set Interval",
    Options = {"30 Seconds", "1 Minute", "5 Minutes", "10 Minutes", "20 Minutes", "30 Minutes", "45 Minutes", "60 Minutes"},
    CurrentOption = {"30 Seconds"},
    Callback = function(Option)
        local times = {["30 Seconds"]=30,["1 Minute"]=60,["5 Minutes"]=300,["10 Minutes"]=600,["20 Minutes"]=1200,["30 Minutes"]=1800,["45 Minutes"]=2700,["60 Minutes"]=3600}
        selectedTime = times[Option[1]] or 30
        countdown = 0
    end,
})

Afk:CreateDropdown({
    Name = "Select Machine Mode",
    Options = {"Default", "All Machine", "ATM", "Blackhole", "Arcade", "Valentines", "Doom"},
    CurrentOption = {"Default"},
    Callback = function(Option) selectedMachine = Option[1] end,
})

Afk:CreateToggle({Name = "Auto Deposit", CurrentValue = false, Callback = function(v) autoDeposit = v end})
Afk:CreateToggle({Name = "Auto Craft", CurrentValue = false, Callback = function(v) autoCraft = v end})

Afk:CreateButton({
    Name = "Withdraw All Brainrots",
    Callback = function()
        local m = getActiveMachine()
        if m then
            -- Updated Remote Path for Withdrawal
            game:GetService("ReplicatedStorage"):WaitForChild("Shared"):WaitForChild("Remotes"):WaitForChild("Networking"):WaitForChild("RF/SpawnMachineAction"):InvokeServer("Withdraw", m)
        else
            Rayfield:Notify({Title = "Error", Content = "Machine not found to withdraw from.", Duration = 3})
        end
    end,
})

Afk:CreateButton({Name = "Go to Surface", Callback = function() tweenToSurface(surfaceCoords) end})

-- AUTOMATIC SETUP ON EXECUTION
setupStaticPlatforms()

local SettingsTab = Window:CreateTab("Settings", 4483345998)
SettingsTab:CreateButton({
    Name = "Destroy UI",
    Callback = function()
        Rayfield:Destroy()
    end,
})

SettingsTab:CreateLabel("Alpha Hub V1.0")

game:GetService("UserInputService").JumpRequest:Connect(function()
    if _G.InfJump then
        pcall(function()
            Player.Character:FindFirstChildOfClass('Humanoid'):ChangeState("Jumping")
        end)
    end
end)

Rayfield:Notify({
    Title = "Alpha Hub Loaded",
    Content = "Welcome, " .. Player.DisplayName .. "!",
    Duration = 5,
    Image = 4483345998,
})
